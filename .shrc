# Reset prompt setting.
_PS_() {
    #
    local reset
    local cyan
    local brightgreen
    local brightblue
    local brightmagenta
    local yellow
    local brightyellow
    local newline

    #
    reset=$'\e[0m'
    cyan=$'\e[36m'
    brightgreen=$'\e[92m'
    brightblue=$'\e[94m'
    brightmagenta=$'\e[95m'
    yellow=$'\e[33m'
    brightyellow=$'\e[93m'
    newline=$'\n'

    #
    local cmdhd

    #
    case $(ps -p $$ | tail -1 | awk "{print \$NF}") in
    *bash*)
        #
        shopt -s promptvars

        #
        cmdhd=
        cmdhd="${cmdhd}#${cyan}\#${reset}"
        cmdhd="${cmdhd} ${brightgreen}\u${reset}"
        cmdhd="${cmdhd}@${brightblue}\h${reset}"
        cmdhd="${cmdhd}[${brightmagenta}${STY#*.}${reset}]"
        cmdhd="${cmdhd}:${yellow}\w${reset}"
        cmdhd="${cmdhd}|${brightyellow}\W${reset}"
        ;;
    *zsh*)
        #
        cmdhd=
        cmdhd="${cmdhd}#${cyan}%h${reset}"
        cmdhd="${cmdhd} ${brightgreen}%n${reset}"
        cmdhd="${cmdhd}@${brightblue}%m${reset}"
        cmdhd="${cmdhd}[${brightmagenta}${STY#*.}${reset}]"
        cmdhd="${cmdhd}:${yellow}%~${reset}"
        cmdhd="${cmdhd}|${brightyellow}%.${reset}"
        ;;
    *)
        return
        ;;
    esac

    #
    export PS1="${newline}${reset}${cmdhd}${reset}${newline}$ "
}

# Alias new commands.
_ALIAS_() {
    #
    alias lsc="ls --color"

    #
    if [[ -n $(which nvcc 2>/dev/null) ]]; then
        #
        alias gpustats="watch -n 0.1 nvidia-smi"
    fi
}

# CUDA
_CUDA_() {
    #
    if [[ -n $(which module 2>/dev/null) ]]; then
        #
        module load cuda/11.7
    fi
}

# Slurm
_SLURM_() {
    #
    if [[ -n $(which module 2>/dev/null) ]]; then
        #
        module load slurm
    fi

    #
    if [[ -n $(which slurm 2>/dev/null) ]]; then
        # Use customized slurm queue log.
        export SQUEUE_FORMAT="%.10i %.9P %.8u %.28j %.2t %.10M"
    fi
}

# CONDA
_CONDA_() {
    # Skip conda initialization if conda root is not defined.
    if [[ -z ${CONDA} ]]; then
        #
        return
    fi

    # Essential for conda initialization.
    __conda_setup="$("${CONDA}/bin/conda" 'shell.bash' 'hook' 2>/dev/null)"
    if [[ $? -eq 0 ]]; then
        #
        eval "$__conda_setup"
    else
        #
        if [[ -f "${__conda_root}/etc/profile.d/conda.sh" ]]; then
            #
            . "${__conda_root}/etc/profile.d/conda.sh"
        else
            # Prioritize this setting over system setting.
            export PATH="${__conda_root}/bin:${PATH}"
        fi
    fi
    unset __conda_setup

    #
    conda activate Default
}

# Reset terminal log.
_PS_

# Enable essential softwares.
_CUDA_
_SLURM_

# Register essential commands.
_ALIAS_

# Enable virtual environment.
_CONDA_
